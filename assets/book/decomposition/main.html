<!DOCTYPE html>

<html class="light sidebar-visible" dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Decompositions - Compositional Interpretability</title>

    <meta content="" name="description" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="#ffffff" name="theme-color" />
    <link href="../favicon.svg" rel="icon" />
    <link href="../favicon.png" rel="shortcut icon" />
    <link href="../css/variables.css" rel="stylesheet" />
    <link href="../css/general.css" rel="stylesheet" />
    <link href="../css/chrome.css" rel="stylesheet" />
    <link href="../css/print.css" media="print" rel="stylesheet" />

    <link href="../FontAwesome/css/font-awesome.css" rel="stylesheet" />
    <link href="../fonts/fonts.css" rel="stylesheet" />

    <link href="../highlight.css" id="highlight-css" rel="stylesheet" />
    <link href="../tomorrow-night.css" id="tomorrow-night-css" rel="stylesheet" />
    <link href="../ayu-highlight.css" id="ayu-highlight-css" rel="stylesheet" />

    <link href="../style.css" rel="stylesheet" />

    <script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script>
      var path_to_root = "../";
      var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <script src="../toc.js"></script>
  </head>
  <body>
    <div id="body-container">
      <script>
        try {
          var theme = localStorage.getItem("mdbook-theme");
          var sidebar = localStorage.getItem("mdbook-sidebar");

          if (theme.startsWith('"') && theme.endsWith('"')) {
            localStorage.setItem("mdbook-theme", theme.slice(1, theme.length - 1));
          }

          if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
            localStorage.setItem("mdbook-sidebar", sidebar.slice(1, sidebar.length - 1));
          }
        } catch (e) {}
      </script>

      <script>
        var theme;
        try {
          theme = localStorage.getItem("mdbook-theme");
        } catch (e) {}
        if (theme === null || theme === undefined) {
          theme = default_theme;
        }
        const html = document.documentElement;
        html.classList.remove("light");
        html.classList.add(theme);
        html.classList.add("js");
      </script>
      <input class="hidden" id="sidebar-toggle-anchor" type="checkbox" />

      <script>
        var sidebar = null;
        var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
        if (document.body.clientWidth >= 1080) {
          try {
            sidebar = localStorage.getItem("mdbook-sidebar");
          } catch (e) {}
          sidebar = sidebar || "visible";
        } else {
          sidebar = "hidden";
        }
        sidebar_toggle.checked = sidebar === "visible";
        html.classList.remove("sidebar-visible");
        html.classList.add("sidebar-" + sidebar);
      </script>
      <nav aria-label="Table of contents" class="sidebar" id="sidebar">
        <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
        <noscript>
          <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
        </noscript>
        <div class="sidebar-resize-handle" id="sidebar-resize-handle">
          <div class="sidebar-resize-indicator"></div>
        </div>
      </nav>
      <div class="page-wrapper" id="page-wrapper">
        <div class="page">
          <div id="menu-bar-hover-placeholder"></div>
          <div class="menu-bar sticky" id="menu-bar">
            <div class="left-buttons">
              <label
                aria-controls="sidebar"
                aria-label="Toggle Table of Contents"
                class="icon-button"
                for="sidebar-toggle-anchor"
                id="sidebar-toggle"
                title="Toggle Table of Contents"
              >
                <i class="fa fa-bars"></i>
              </label>
              <button
                aria-controls="theme-list"
                aria-expanded="false"
                aria-haspopup="true"
                aria-label="Change theme"
                class="icon-button"
                id="theme-toggle"
                title="Change theme"
                type="button"
              >
                <i class="fa fa-paint-brush"></i>
              </button>
              <ul aria-label="Themes" class="theme-popup" id="theme-list" role="menu">
                <li role="none"><button class="theme" id="light" role="menuitem">Light</button></li>
                <li role="none"><button class="theme" id="rust" role="menuitem">Rust</button></li>
                <li role="none"><button class="theme" id="coal" role="menuitem">Coal</button></li>
                <li role="none"><button class="theme" id="navy" role="menuitem">Navy</button></li>
                <li role="none"><button class="theme" id="ayu" role="menuitem">Ayu</button></li>
              </ul>
              <button
                aria-controls="searchbar"
                aria-expanded="false"
                aria-keyshortcuts="S"
                aria-label="Toggle Searchbar"
                class="icon-button"
                id="search-toggle"
                title="Search. (Shortkey: s)"
                type="button"
              >
                <i class="fa fa-search"></i>
              </button>
            </div>
            <h1 class="menu-title">Compositional Interpretability</h1>
            <div class="right-buttons">
              <a aria-label="Print this book" href="../print.html" title="Print this book">
                <i class="fa fa-print" id="print-button"></i>
              </a>
            </div>
          </div>
          <div class="hidden" id="search-wrapper">
            <form class="searchbar-outer" id="searchbar-outer">
              <input
                aria-controls="searchresults-outer"
                aria-describedby="searchresults-header"
                id="searchbar"
                name="searchbar"
                placeholder="Search this book ..."
                type="search"
              />
            </form>
            <div class="searchresults-outer hidden" id="searchresults-outer">
              <div class="searchresults-header" id="searchresults-header"></div>
              <ul id="searchresults"></ul>
            </div>
          </div>

          <script>
            document.getElementById("sidebar-toggle").setAttribute("aria-expanded", sidebar === "visible");
            document.getElementById("sidebar").setAttribute("aria-hidden", sidebar !== "visible");
            Array.from(document.querySelectorAll("#sidebar a")).forEach(function (link) {
              link.setAttribute("tabIndex", sidebar === "visible" ? 0 : -1);
            });
          </script>
          <div class="content" id="content">
            <main>
              <h1 id="decompositions"><a class="header" href="#decompositions">Decompositions</a></h1>
              <p>
                Decompositions aim to break down matrices (or tensors) into simpler (to understand) components. Rank decompositions are by far most
                common, factorising matrices into sums of outer products. By ordering these factors by importance, one often finds meaningful and
                informative structures. For rank specifically, one can bound the number of required factors to reach exact reconstruction. Hence, one
                can optimally trade off accuracy for 'effort' by only considering the highest components.
              </p>
              <p>
                This chapter focusses on such rank-decompositions, specifically how to compute them efficiently. However, instead of decomposing
                tensors directly, we decompose the wires connecting them. This corresponds to ordering these based on global importance, structuring
                matrix communication. Intuitively, this 'aligns' consecutive matrices with each other, but in a globally informed manner. In practice,
                we find that this approach strongly outperforms any local algorithms like SVD.
              </p>
              <blockquote>
                <p>
                  This chapter explains these algorithms and is hence the most technical part of this book. If you aren't particularly interested in
                  the implementation details, it is recommended to skim this section to understand the main intuitions.
                </p>
              </blockquote>
              <h3 id="rank-versus-sparsity"><a class="header" href="#rank-versus-sparsity">Rank versus sparsity</a></h3>
              <p>
                The last few decades has seen a shift from rank-based toward sparsity-based methods. Sparsity is a good proxy toward useful and
                interpretable structures. While the algorithms in this sections are explained for full model decompositions, they can (and should) be
                combined with sparsity-based methods.
              </p>
              <h3 id="algorithm-overview"><a class="header" href="#algorithm-overview">Algorithm overview</a></h3>
              <p>
                The algorithm presented in this section relies on 'gauge freedom'. This is a fancy word for invariances within the tensor
                representation. Specifically, a matrix along with its inverse can be inserted and contracted away at any given wire. This changes the
                internal tensors (in this case \(A \neq A'\) and \(B \neq B'\)) without changing the whole.
              </p>
              <div class="center"><object data="diagrams/gauge.svg"></object></div>
              <p>
                These freedoms are everywhere within neural networks but are generally not exploited because meaningful transformations are hard to
                define and compute.
              </p>

              <blockquote>
                <p>WIP</p>
              </blockquote>
              <p>This algorithm works in two steps:</p>
              <ul>
                <li><strong>Orthogonalisation</strong> preprocesses the network, into a structure called the 'canonical form'.</li>
                <li><strong>Diagonalisation</strong> leverages those properties to order all wires by importance.</li>
              </ul>
              <p>Both routines are really fast, only requiring handful of carefully-selected eigendecompositions.</p>
              <h3 id="gauge-example"><a class="header" href="#gauge-example">Gauge example</a></h3>
              <p>
                While there exist many families of meaningful gauges, this chapter focusses on spectral variants. Consider the query and key matrices
                in the attention mechanism.
              </p>
            </main>
            <nav aria-label="Page navigation" class="nav-wrapper">
              <a
                aria-keyshortcuts="Left"
                aria-label="Previous chapter"
                class="mobile-nav-chapters previous"
                href="../architecture/summary.html"
                rel="prev"
                title="Previous chapter"
              >
                <i class="fa fa-angle-left"></i>
              </a>
              <a
                aria-keyshortcuts="Right"
                aria-label="Next chapter"
                class="mobile-nav-chapters next"
                href="../decomposition/orth.html"
                rel="next prefetch"
                title="Next chapter"
              >
                <i class="fa fa-angle-right"></i>
              </a>
              <div style="clear: both"></div>
            </nav>
          </div>
        </div>
        <nav aria-label="Page navigation" class="nav-wide-wrapper">
          <a
            aria-keyshortcuts="Left"
            aria-label="Previous chapter"
            class="nav-chapters previous"
            href="../architecture/summary.html"
            rel="prev"
            title="Previous chapter"
          >
            <i class="fa fa-angle-left"></i>
          </a>
          <a
            aria-keyshortcuts="Right"
            aria-label="Next chapter"
            class="nav-chapters next"
            href="../decomposition/orth.html"
            rel="next prefetch"
            title="Next chapter"
          >
            <i class="fa fa-angle-right"></i>
          </a>
        </nav>
      </div>
      <script>
        window.playground_copyable = true;
      </script>
      <script src="../elasticlunr.min.js"></script>
      <script src="../mark.min.js"></script>
      <script src="../searcher.js"></script>
      <script src="../clipboard.min.js"></script>
      <script src="../highlight.js"></script>
      <script src="../book.js"></script>
    </div>
  </body>
</html>
